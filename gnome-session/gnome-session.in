#!/bin/sh

SETTING=$(gsettings get org.gnome.system.locale region)
REGION=${SETTING#\'}
REGION=${REGION%\'}

if [ -n "$REGION" ]; then
  export LC_TIME=$REGION
  export LC_NUMERIC=$REGION
  export LC_MONETARY=$REGION
  export LC_MEASUREMENT=$REGION
  export LC_PAPER=$REGION
fi

update_command="dbus-update-activation-environment --all --systemd > /dev/null 2>&1"

if [ "$XDG_SESSION_TYPE" = "wayland" -a
     "$XDG_SESSION_CLASS" != "greeter" -a
     -n "$SHELL" ]; then
  (exec -l $SHELL -c "$update_command") || eval "$update_command"
else
  eval "$update_command"
fi

exec @libexecdir@/gnome-session-binary "$@"
